!function($){function initSelects(){$("select:not(.select2-hidden-accessible)").each(function(i,el){if(!$(el).closest(".entry.tpl").length){var options=$(this).data("select2-options");if(options){$.each(options,function(key,val){-1!==String(val).indexOf("function(")&&(eval("var fn = "+val),options[key]=fn)});var sortable=void 0!==options.sortable&&options.sortable,defaultOptions={containerCssClass:"crown-framework-select2-selection",dropdownCssClass:"crown-framework-select2-dropdown",templateResult:function(e){var t=e.text.match(/^\s+/);if(t){var n=t[0].length/3;return $('<span class="option-depth depth-'+n+'">'+e.text.trim()+"</span>")}return e.text},templateSelection:function(e){return e.text.trim()}};options=$.extend(defaultOptions,options),sortable&&(delete options.sortable,defaultOptions.templateSelection=function(e){var t=$("<span>"+e.text.trim()+"</span>");return t.addClass("label").data("option-value",e.element.value),t}),$(this).select2(options),sortable&&($(el).siblings(".select2-container").find("ul.select2-selection__rendered").sortable({items:"> li.select2-selection__choice",update:function(e,t){var n=$(e.target),s=n.closest(".select2-container").siblings("select.select2-hidden-accessible"),o=[];$("> li.select2-selection__choice",n).each(function(e,n){var t=$("option",s).filter(function(e,t){return $(t).val()==$("span.label",n).data("option-value")}).first();t.length&&o.push(t)});for(var i=o.length-1;0<=i;i--)s.prepend(o[i])}}),$(el).on("select2:select",function(e){var t=e.params.data.id,n=$(this).children("option[value="+t+"]");n.length&&(n.detach(),$("option:selected",this).length?$("option:selected",this).last().after(n):$(this).prepend(n)),$(this).trigger("change")}))}}})}$(document).ready(initSelects),$(document).on("repeaterEntryAdded",".entry",initSelects)}(jQuery);