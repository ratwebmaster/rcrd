!function(o){var s,n=new Array,m=new Array;function e(e){e.preventDefault();var t=(s=o(this).closest(".crown-framework-gallery-input")).data("basename");n[t]||(n[t]=wp.media.frames.crownGalleryCreateFrames[t]=wp.media({title:"Add to Gallery",button:{text:"Add to gallery"},library:{type:"image"},multiple:!0}),n[t].on("select",function(){for(var e=n[t].state().get("selection"),a=[],l=0;l<e.models.length;l++){var r=e.models[l].attributes;a.push(r.id)}i(s,a)})),n[t].open()}function a(e){e.preventDefault(),s=o(this).closest(".crown-framework-gallery-input");var l=[];o("ul.gallery-images > li input[type=hidden]",s).each(function(e,a){l.push(o(a).val())}),i(s,l)}function i(e,a,l,r,t){l=void 0!==l?l:6,r=void 0!==r?r:"file",t=void 0!==t?t:"menu_order ID";var n=s.data("basename"),i=['ids="'+a.join(",")+'"','columns="'+l+'"','link="'+r+'"','orderby="'+t+'"'];m[n]=wp.media.frames.crownGalleryFrames[n]=wp.media.gallery.edit("[gallery "+i.join(" ")+"]"),o(m[n].el).addClass("hidden-gallery-settings"),m[n].on("update",function(e){!function(e,a,l){console.log(l),o("ul.gallery-images li",e).remove(),e.removeClass("has-media");for(var r=0;r<a.length;r++){var t=a[r].attributes,n=t.icon;if("image"==t.type)n=t.sizes.thumbnail?t.sizes.thumbnail.url:t.sizes.full.url;var i=o("<li></li>");i.append('<input type="hidden" name="'+e.data("basename")+'[]" value="'+t.id+'">'),i.append('<img class="thumbnail" src="'+n+'">'),i.append('<a class="gallery-image-remove" href="#" title="Remove Image">&times;</a>'),o("ul.gallery-images",e).append(i),e.addClass("has-media")}}(s,e.models,e.gallery.attributes)})}function l(e){e.preventDefault();var a=o(this).closest("li"),l=a.closest(".crown-framework-gallery-input");1==o("ul.gallery-images > li",l).length&&l.removeClass("has-media"),a.remove()}o(document).ready(function(){o(document).on("click",".crown-framework-gallery-input a.gallery-input-add-images-button",e),o(document).on("click",".crown-framework-gallery-input a.gallery-input-edit-button",a),o(document).on("click",".crown-framework-gallery-input a.gallery-image-remove",l),wp.media.frames.crownGalleryCreateFrames=new Array,wp.media.frames.crownGalleryFrames=new Array,o(".crown-framework-gallery-input .gallery-images").sortable({})})}(jQuery);