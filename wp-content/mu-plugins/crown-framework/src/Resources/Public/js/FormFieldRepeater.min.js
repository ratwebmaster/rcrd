!function(i){function e(e){e.preventDefault();var t=i(this).closest(".crown-framework-field.repeater").find("> .input-wrap > .field-repeater-entries"),r=null,a=!1;if(i(this).closest(".crown-framework-field.repeater").hasClass("flex-repeater")){i(".crown-framework-field.flex-repeater .add-flex-field-repeater-entry-options.active").removeClass("active"),i(".crown-framework-field.flex-repeater .entry > .add-field-repeater-entry-container.active").removeClass("active");var n=i(this).data("entry-type");r=i("> .entry.tpl.type-"+n,t).clone(),i(this).closest(".add-flex-field-repeater-entry-options").is(".mid-list.before")&&(a=i(this).closest(".entry"))}else r=i("> .entry.tpl",t).clone(),i(this).is(".mid-list.before")&&(a=i(this).closest(".entry"));var o=(new Date).getTime();r.removeClass("tpl"),i("input, select, textarea",r).each(function(e,t){if(i(t).closest(".field-repeater-entries").length)i(t).hasClass("rich-textarea-settings")?i(t).val(i(t).val().replace("{{index}}","new_entry_"+o)):i(t).data("tpl-name")&&i(t).attr("data-tpl-name",i(t).data("tpl-name").replace("{{index}}","new_entry_"+o));else if(i(t).hasClass("rich-textarea-settings")){var r=i(t),a=JSON.parse(r.val());a.action="get_rich_textarea",a.id=a.id+o,a.settings.textarea_name=a.settings.textarea_name.replace("{{index}}","new_entry_"+o),i.get(crownFormFieldRepeaterData.ajaxUrl,a,function(e){r.after(e),r.remove(),i("textarea.wp-editor-area",e).each(function(e,t){var r=i(t).attr("id"),a=tinyMCEPreInit.mceInit[r];a.setup=function(e){e.on("init",function(e){i("#wp-"+r+"-wrap").hasClass("html-active")&&(i("#wp-"+r+"-wrap textarea.wp-editor-area").show(),i("#wp-"+r+"-wrap .mce-tinymce").hide(),i("#"+r+"-html").trigger("click"))})},tinyMCE.init(a),quicktags(tinyMCEPreInit.qtInit[r]),QTags._buttonsInit()})})}else i(t).data("tpl-name")&&(i(t).attr("name",i(t).data("tpl-name").replace("{{index}}","new_entry_"+o)),1==i(t).data("tpl-required")&&i(t).attr("required",!0))}),i(".crown-framework-gallery-input",r).each(function(e,t){i(t).attr("data-basename",i(t).attr("data-basename").replace("{{index}}","new_entry_"+o))}),i(".google-map.map-configured",r).each(function(e,t){if(!i(t).closest(".entry").hasClass("tpl")){var r=i(t).attr("id"),a="google-map-"+Math.floor(2147483647*Math.random());i(t).attr("id",a),i(t).next("script").html(i(t).next("script").html().replace(r,a)),window.googleMapSettings[a]=i.extend({},window.googleMapSettings[r],{autoInit:!0})}}),i(".crown-framework-field.repeater .field-repeater-entries",r).sortable({items:"> .entry:not(.tpl)",handle:"> .sort-handle"}).on("sortstart",function(e){e.stopPropagation(),l(e,!1)}).on("sortstop",function(e){e.stopPropagation(),l(e,!0)}),i(".crown-framework-checkbox-set-input.sortable > .inner",r).sortable(),a&&a.length?a.before(r):t.append(r),i(".crown-framework-colorpicker-input",r).trigger("initColorpicker"),i(".google-map.map-configured",r).each(function(e,t){i(t).closest(".entry").hasClass("tpl")||i(t).trigger("googleMapAutoInit")}),r.trigger("repeaterEntryAdded")}function t(e){e.preventDefault();var t=i(this).closest(".entry");t.hasClass("tpl")||confirm("Are you sure you want to remove this entry?")&&(t.trigger("repeaterEntryRemove"),t.remove())}function l(e,n){i("textarea.wp-editor-area",i(e.srcElement).closest(".entry")).each(function(e,t){var r=tinyMCE.get(t.id),a=i(t).parents(".tmce-active").length;n?!r&&a&&tinyMCE.execCommand("mceAddEditor",!0,t.id):r&&(r.save(),tinyMCE.execCommand("mceRemoveEditor",!0,t.id))})}i(document).ready(function(){i(document).on("click",".crown-framework-field.repeater .add-field-repeater-entry",e),i(document).on("click",".crown-framework-field.flex-repeater .add-flex-field-repeater-entry-options .options a",e),i(document).on("click",".crown-framework-field.repeater .entry .remove-field-repeater-entry",t),i(".crown-framework-field.repeater.flex-repeater").each(function(e,t){var r=i("> .input-wrap > .add-flex-field-repeater-entry-options",t);i("> .input-wrap > .field-repeater-entries > .entry",t).each(function(e,t){i("> .add-field-repeater-entry-container.before",t).append(r.clone().addClass("mid-list before")),i("> .add-field-repeater-entry-container.after",t).append(r.clone().addClass("mid-list after"))})}),i(".crown-framework-field.repeater .field-repeater-entries").sortable({items:"> .entry:not(.tpl)",handle:"> .sort-handle, > .entry-header"}).on("sortstart",function(e){e.stopPropagation(),l(e,!1)}).on("sortstop",function(e){e.stopPropagation(),l(e,!0)}),i(document).on("click",".crown-framework-field.repeater .entry .entry-header",function(e){i(this).closest(".entry").toggleClass("collapsed")}),i(document).on("click",".crown-framework-field.flex-repeater .add-flex-field-repeater-entry-options .dropdown-toggle",function(e){e.preventDefault(),e.stopPropagation();var t=i(this).closest(".add-flex-field-repeater-entry-options");i(".crown-framework-field.flex-repeater .add-flex-field-repeater-entry-options.active").not(t).removeClass("active"),t.toggleClass("active");var r=!!t.is(".mid-list")&&t.parent();r&&r.length?(i(".crown-framework-field.flex-repeater .entry > .add-field-repeater-entry-container.active").not(r).removeClass("active"),r.toggleClass("active")):i(".crown-framework-field.flex-repeater .entry > .add-field-repeater-entry-container.active").removeClass("active")}),i(document).on("click",".crown-framework-field.flex-repeater .add-flex-field-repeater-entry-options .dropdown",function(e){e.stopPropagation()}),i(document).on("click",function(e){i(".crown-framework-field.flex-repeater .add-flex-field-repeater-entry-options.active").removeClass("active"),i(".crown-framework-field.flex-repeater .entry > .add-field-repeater-entry-container.active").removeClass("active")})})}(jQuery);